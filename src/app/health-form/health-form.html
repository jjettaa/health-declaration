<!-- health-form.component.html -->
<div class="page-wrapper">
  <div class="health-form-card">
    <div class="health-form-header">
      <h2>Gesundheitsdeklaration</h2>
      <button mat-icon-button aria-label="Menu" class="menu-button">
        <mat-icon>menu</mat-icon>
      </button>
    </div>


  <!-- Accordion with only Question 1 -->
  <form [formGroup]="form">
    <mat-accordion [multi]="false" class="health-form-accordion">

    <mat-expansion-panel [expanded]="currentStep === 1">
        <mat-expansion-panel-header>
          <mat-panel-title>1. Grosse und Gewicht</mat-panel-title>
        </mat-expansion-panel-header>

        <div class="step-content">
          <p class="subtitle">Welches sind Ihre Körpermasse?</p>
        
        <div class="field-row">
        <mat-form-field appearance="outline" [class.filled]="!!form.get('height')?.value">
            <span matPrefix class="prefix-spacer"></span>

             <input
              matInput
              type="number"
              formControlName="height"
              placeholder="Größe"
              min="1" step="1" inputmode="numeric" pattern="\d*"
              (keydown)="blockBadKeys($event)"
              (paste)="blockBadPaste($event)"
            />

            <span matSuffix>(cm)</span>
            <mat-error *ngIf="form.get('height')?.hasError('required')">
            Erforderlich
            </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" [class.filled]="!!form.get('weight')?.value">
            <span matPrefix class="prefix-spacer"></span>

           <input
            matInput
            type="number"
            formControlName="weight"
            placeholder="Gewicht"
            min="1" step="1" inputmode="numeric" pattern="\d*"
            (keydown)="blockBadKeys($event)"
            (paste)="blockBadPaste($event)"
          />

            <span matSuffix>(kg)</span>
            <mat-error *ngIf="form.get('weight')?.hasError('required')">
            Erforderlich
            </mat-error>
        </mat-form-field>

        </div>
          <p class="subtitle">
    - Falls Sie schwanger sind, geben Sie bitte Ihr Gewicht zu Beginn der Schwangerschaft an.
  </p>
        </div>

  <div class="panel-actions" *ngIf="currentStep === 1 && !isStepDone(1)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(1)">
      Weiter
    </button>
  </div>
      </mat-expansion-panel>

<!-- QUESTION 2 -->
<mat-expansion-panel *ngIf="maxStep >= 2" [expanded]="currentStep === 2">
  <mat-expansion-panel-header>
    <mat-panel-title>2. Medikamente oder Hilfsmittel</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">
    <!-- Yes/No -->
    <mat-button-toggle-group
      formControlName="medication"
      class="med-toggle-group"
      [class.selected]="form.get('medication')?.value !== null"
      aria-label="Medikamentenauswahl"
    >
      <mat-button-toggle value="no">Nein</mat-button-toggle>
      <mat-button-toggle value="yes">Ja</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error class="toggle-error"
      *ngIf="form.get('medication')?.hasError('required') && form.get('medication')?.touched && currentStep === 2">
      Bitte Ja oder Nein auswählen
    </mat-error>

    <!-- CONDITIONAL CONTENT (now a real element so we can scroll to it) -->
    <div #medBlock *ngIf="form.get('medication')?.value === 'yes'">
      <p class="subtitle">
        Nehmen Sie momentan Medikamente ein oder haben Sie in den letzten 2 Jahren regelmäßig oder
        wiederholt welche eingenommen (mit Ausnahme von Verhütungsmitteln) oder haben Sie eine
        medizinische Verordnung für Hilfsmittel oder Geräte erhalten
        (mit Ausnahme von Brillen und Kontaktlinsen)?
      </p>

      <div class="field-row">
        <div>
          <p class="subtitle">Wenn ja, welche:</p>
          <mat-form-field appearance="outline" [class.filled]="!!form.get('medicationName')?.value">
            <span matPrefix class="prefix-spacer"></span>
            <input matInput formControlName="medicationName" placeholder="Hier eingeben…" />
            <mat-error *ngIf="form.get('medicationName')?.hasError('required') && form.get('medicationName')?.touched">
              Erforderlich
            </mat-error>
          </mat-form-field>
        </div>

        <div>
          <p class="subtitle">Warum:</p>
          <mat-form-field appearance="outline" [class.filled]="!!form.get('medicationReason')?.value">
            <span matPrefix class="prefix-spacer"></span>
            <input matInput formControlName="medicationReason" placeholder="Hier eingeben…" />
            <mat-error *ngIf="form.get('medicationReason')?.hasError('required') && form.get('medicationReason')?.touched">
              Erforderlich
            </mat-error>
          </mat-form-field>
        </div>
      </div>

      <!-- CONDITIONS ARRAY -->
      <div formArrayName="conditions" class="conditions-list">
        <div
          *ngFor="let condGroup of conditionsArray.controls; let i = index"
          [formGroupName]="i"
          class="condition-entry"
          #condEntry
        >
          <div class="condition-header">
            <h3 class="condition-title">{{ i + 1 }}) Krankheit erfassen</h3>
            <a *ngIf="i > 0" mat-button color="warn" class="remove-btn" (click)="removeCondition(i)">– Entfernen</a>
          </div>

          <p class="subtitle">
            Krankheit, Leiden, Unfall, Behandlungsgrund, betroffene Stelle am Körper (links, rechts)
          </p>

          <!-- description -->
          <div class="field-row">
            <mat-form-field appearance="outline" [class.filled]="!!condGroup.get('description')?.value" class="full-row">
              <span matPrefix class="prefix-spacer"></span>
              <input matInput formControlName="description" placeholder="Ihre Eingabe" type="text" />
              <mat-error *ngIf="condGroup.get('description')?.touched && condGroup.get('description')?.hasError('required')">
                Erforderlich
              </mat-error>
            </mat-form-field>
          </div>

          <!-- dates -->
          <div class="field-row">
            <div class="date-field">
              <p class="subtitle">Beginndatum</p>
              <mat-form-field appearance="outline" [class.filled]="!!condGroup.get('startDate')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input matInput [matDatepicker]="startPicker" formControlName="startDate" placeholder="TT.MM.JJJJ" />
                <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                <mat-datepicker #startPicker></mat-datepicker>
                <mat-error *ngIf="condGroup.get('startDate')?.touched && condGroup.get('startDate')?.hasError('required')">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>

            <div class="date-field">
              <p class="subtitle">Enddatum</p>
              <mat-form-field appearance="outline" [class.filled]="!!condGroup.get('endDate')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input matInput [matDatepicker]="endPicker" formControlName="endDate" placeholder="TT.MM.JJJJ" [min]="condGroup.get('startDate')?.value"/>
                <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
                <mat-datepicker #endPicker></mat-datepicker>
                <mat-error *ngIf="condGroup.get('endDate')?.touched && condGroup.get('endDate')?.hasError('required')">
                  Erforderlich
                </mat-error>
                <mat-error *ngIf="condGroup.get('endDate')?.hasError('dateOrder')">
                  Enddatum vor Beginn
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <!-- operated -->
          <p class="subtitle">Operiert?</p>
          <mat-button-toggle-group
            formControlName="operated"
            class="med-toggle-group"
            [class.selected]="condGroup.get('operated')?.value !== null"
            aria-label="Operiert?"
          >
            <mat-button-toggle value="no">Nein</mat-button-toggle>
            <mat-button-toggle value="yes">Ja</mat-button-toggle>
          </mat-button-toggle-group>
          <mat-error class="toggle-error" *ngIf="condGroup.get('operated')?.invalid && condGroup.get('operated')?.touched">
            Bitte Ja oder Nein auswählen
          </mat-error>

          <!-- recovered -->
          <p class="subtitle">Behandlung beendet, genesen ohne Folgen</p>
          <mat-button-toggle-group
            formControlName="recovered"
            class="med-toggle-group"
            [class.selected]="condGroup.get('recovered')?.value !== null"
            aria-label="Genesen?"
          >
            <mat-button-toggle value="no">Nein</mat-button-toggle>
            <mat-button-toggle value="yes">Ja</mat-button-toggle>
          </mat-button-toggle-group>
          <mat-error class="toggle-error" *ngIf="condGroup.get('recovered')?.invalid && condGroup.get('recovered')?.touched">
            Bitte Ja oder Nein auswählen
          </mat-error>

          <!-- doctor address -->
          <p class="subtitle">Name und Adresse des Arztes, Spitals oder anderen Leistungserbringers</p>

          <div class="field-row">
            <div>
              <mat-form-field appearance="outline" [class.filled]="!!condGroup.get('doctorName')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input matInput formControlName="doctorName" placeholder="Name" />
                <mat-error *ngIf="condGroup.get('doctorName')?.touched && condGroup.get('doctorName')?.hasError('required')">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>

            <div>
              <mat-form-field appearance="outline" [class.filled]="!!condGroup.get('doctorLastName')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input matInput formControlName="doctorLastName" placeholder="Straße" />
                <mat-error *ngIf="condGroup.get('doctorLastName')?.touched && condGroup.get('doctorLastName')?.hasError('required')">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <div class="field-row address-row">
            <div>
              <mat-form-field appearance="outline" class="street-col" [class.filled]="!!condGroup.get('doctorStreet')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input matInput formControlName="doctorStreet" placeholder="Doktorstrasse" />
                <mat-error *ngIf="condGroup.get('doctorStreet')?.touched && condGroup.get('doctorStreet')?.hasError('required')">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>
            <div>
              <mat-form-field appearance="outline" class="number-col" [class.filled]="!!condGroup.get('doctorStreetNo')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input matInput
                  type="number"
                  formControlName="doctorStreetNo"
                  placeholder="Nr."
                  min="1" step="1" inputmode="numeric" pattern="\d*"
                  (keydown)="blockBadKeys($event)"
                  (paste)="blockBadPaste($event)"
                />
                <mat-error *ngIf="condGroup.get('doctorStreetNo')?.touched && condGroup.get('doctorStreetNo')?.hasError('required')">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <div class="field-row">
            <mat-form-field appearance="outline" [class.filled]="!!condGroup.get('doctorCity')?.value" class="full-row">
              <span matPrefix class="prefix-spacer"></span>
              <input
                matInput
                formControlName="doctorCity"
                placeholder="PLZ"
                type="text"
                [matAutocomplete]="plzAuto"
                inputmode="text"
                pattern="\d*"
              />
              <mat-autocomplete
                #plzAuto="matAutocomplete"
                [displayWith]="plzDisplay"
                (optionSelected)="condGroup.get('doctorCity')?.setValue($event.option.value)"
              >
                <ng-container *ngIf="plzOptionsCond$[i] | async as options">
                  <mat-option *ngFor="let z of options" [value]="z">
                    {{ z.code }} — {{ z.place }} <span *ngIf="z.state">({{ z.state }})</span>
                  </mat-option>
                  <mat-option *ngIf="options.length === 0 && ((condGroup.get('doctorCity')?.value || '').length >= 4)" disabled>
                    Keine Treffer
                  </mat-option>
                </ng-container>
              </mat-autocomplete>
              <mat-error *ngIf="condGroup.get('doctorCity')?.touched && condGroup.get('doctorCity')?.hasError('required')">
                Erforderlich
              </mat-error>
            </mat-form-field>
          </div>
        </div> <!-- end condition-entry -->
      </div> <!-- end conditions list -->

      <!-- Add-condition button INSIDE this panel -->
      <div class="panel-actions">
        <button mat-flat-button color="primary" class="add-condition-btn" (click)="addCondition()">
          + Krankheit erfassen
        </button>
      </div>
    </div>
  </div>

  <div class="panel-actions" *ngIf="currentStep === 2 && !isStepDone(2)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(2)">Weiter</button>
  </div>
</mat-expansion-panel>





<!-- QUESTIIOOONN 3 -->
<mat-expansion-panel *ngIf="maxStep  >= 3" [expanded]="currentStep === 3">
  <mat-expansion-panel-header>
    <mat-panel-title>3. Krankheiten oder Beschwerden</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">
    <!-- Toggle group for Yes/No -->
    <mat-button-toggle-group
      formControlName="hadIllness"
      class="med-toggle-group"
      [class.selected]="form.get('hadIllness')?.value !== null"
      aria-label="Krankheiten Ja/Nein"
    >
      <mat-button-toggle value="no">Nein</mat-button-toggle>
      <mat-button-toggle value="yes">Ja</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error class="toggle-error"
      *ngIf="form.get('hadIllness')!.hasError('required') && form.get('hadIllness')!.touched && currentStep === 3">
      Bitte Ja oder Nein auswählen
    </mat-error>

    <!-- SAME WRAPPER; now with a scroll anchor -->
    <div #illBlock *ngIf="form.get('hadIllness')?.value === 'yes'">

      <p class="subtitle">
        Haben Sie in den vergangenen 5 Jahren an Krankheiten oder Beschwerden gelitten oder leiden Sie noch daran (ausser saisonale Krankheiten und geheilte Covid-Erkrankung ohne Nebenwirkung oder Langzeitfolgen)?  
        Als Krankheiten oder Beschwerden gelten beispielsweise: Diabetes, Wirbelsäulenerkrankungen, Krebs oder Tumore, Suchterkrankungen (Drogen, Alkohol, Medikamente), HIV (AIDS), Long-Covid, Essstörungen etc.  
        Diese Aufzählung ist nicht abschliessend.
      </p>

      <!-- Render each condition group -->
      <div formArrayName="illnesses" class="conditions-list">
        <div
          #illEntry
          *ngFor="let illGroup of illnessesArray.controls; let i = index"
          [formGroupName]="i"
          class="condition-entry"
        >
          <!-- Header with remove -->
          <div class="condition-header">
            <h3 class="condition-title">{{ i + 1 }}) Krankheit erfassen</h3>
            <a *ngIf="i > 0" mat-button color="warn" class="remove-btn" (click)="removeIllness(i)">– Entfernen</a>
          </div>

          <!-- Subtitle -->
          <p class="subtitle">
            Krankheit, Leiden, Unfall, Behandlungsgrund, betroffene Stelle am Körper (links, rechts)
          </p>

          <!-- Description -->
          <div class="field-row">
            <mat-form-field
              appearance="outline"
              [class.filled]="!!illGroup.get('description')?.value"
              class="full-row"
            >
              <span matPrefix class="prefix-spacer"></span>
              <input
                matInput
                formControlName="description"
                placeholder="Ihre Eingabe"
                type="text"
              />
              <mat-error *ngIf="
                illGroup.get('description')!.touched &&
                illGroup.get('description')!.hasError('required')
              ">
                Erforderlich
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Date pickers -->
          <div class="field-row">
            <!-- Beginn -->
            <div class="date-field">
              <p class="subtitle">Beginndatum</p>
              <mat-form-field appearance="outline" [class.filled]="!!illGroup.get('startDate')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input
                  matInput
                  [matDatepicker]="startPicker"
                  formControlName="startDate"
                  placeholder="TT.MM.JJJJ"
                />
                <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                <mat-datepicker #startPicker></mat-datepicker>
                <mat-error *ngIf="
                  illGroup.get('startDate')!.touched &&
                  illGroup.get('startDate')!.hasError('required')
                ">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Ende -->
            <div class="date-field">
              <p class="subtitle">Enddatum</p>
              <mat-form-field appearance="outline" [class.filled]="!!illGroup.get('endDate')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input
                  matInput
                  [matDatepicker]="endPicker"
                  formControlName="endDate"
                  placeholder="TT.MM.JJJJ"
                />
                <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
                <mat-datepicker #endPicker></mat-datepicker>
                <mat-error *ngIf="illGroup.get('endDate')?.touched && illGroup.get('endDate')?.hasError('required')">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <p class="subtitle">Operiert?</p>
          <mat-button-toggle-group
            formControlName="operated"
            class="med-toggle-group"
            [class.selected]="illGroup.get('operated')?.value !== null"
            aria-label="Operiert?"
          >
            <mat-button-toggle value="no">Nein</mat-button-toggle>
            <mat-button-toggle value="yes">Ja</mat-button-toggle>
          </mat-button-toggle-group>
          <mat-error class="toggle-error"
                     *ngIf="illGroup.get('operated')!.invalid && illGroup.get('operated')!.touched">
            Bitte Ja oder Nein auswählen
          </mat-error>

          <!-- Genesen? -->
          <p class="subtitle">Behandlung beendet, genesen ohne Folgen</p>
          <mat-button-toggle-group
            formControlName="recovered"
            class="med-toggle-group"
            [class.selected]="illGroup.get('recovered')?.value !== null"
            aria-label="Genesen?"
          >
            <mat-button-toggle value="no">Nein</mat-button-toggle>
            <mat-button-toggle value="yes">Ja</mat-button-toggle>
          </mat-button-toggle-group>
          <mat-error class="toggle-error"
                     *ngIf="illGroup.get('recovered')!.invalid && illGroup.get('recovered')!.touched">
            Bitte Ja oder Nein auswählen
          </mat-error>

          <!-- Arztadresse -->
          <p class="subtitle">Name und Adresse des Arztes, Spitals oder anderen Leistungserbringers</p>
          <div class="field-row">
            <div>
              <mat-form-field appearance="outline" [class.filled]="!!illGroup.get('doctorName')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input matInput formControlName="doctorName" placeholder="Name" />
                <mat-error *ngIf="illGroup.get('doctorName')?.touched && illGroup.get('doctorName')?.hasError('required')">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>

            <div>
              <mat-form-field appearance="outline" [class.filled]="!!illGroup.get('doctorLastName')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input matInput formControlName="doctorLastName" placeholder="Straße" />
                <mat-error *ngIf="illGroup.get('doctorLastName')?.touched && illGroup.get('doctorLastName')?.hasError('required')">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <div class="field-row address-row">
            <div>
              <mat-form-field appearance="outline" class="street-col" [class.filled]="!!illGroup.get('doctorStreet')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input matInput formControlName="doctorStreet" placeholder="Doktorstrasse" />
                <mat-error *ngIf="
                  illGroup.get('doctorStreet')!.touched &&
                  illGroup.get('doctorStreet')!.hasError('required')
                ">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>
            <div>
              <mat-form-field appearance="outline" class="number-col" [class.filled]="!!illGroup.get('doctorStreetNo')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input
                  matInput
                  type="number"
                  formControlName="doctorStreetNo"
                  placeholder="Nr."
                  min="1" step="1" inputmode="numeric" pattern="\d*"
                  (keydown)="blockBadKeys($event)"
                  (paste)="blockBadPaste($event)"
                />
                <mat-error *ngIf="
                  illGroup.get('doctorStreetNo')!.touched &&
                  illGroup.get('doctorStreetNo')!.hasError('required')
                ">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <div class="field-row">
            <mat-form-field appearance="outline" [class.filled]="!!illGroup.get('doctorCity')?.value" class="full-row">
              <span matPrefix class="prefix-spacer"></span>
              <input
                matInput
                formControlName="doctorCity"
                placeholder="PLZ"
                type="text"
                [matAutocomplete]="plzAuto"
                inputmode="text"
                pattern="\d*"
              />
              <mat-autocomplete
                #plzAuto="matAutocomplete"
                [displayWith]="plzDisplay"
                (optionSelected)="illGroup.get('doctorCity')?.setValue($event.option.value)"
              >
                <ng-container *ngIf="plzOptionsIll$[i] | async as options">
                  <mat-option *ngFor="let z of options" [value]="z">
                    {{ z.code }} — {{ z.place }} <span *ngIf="z.state">({{ z.state }})</span>
                  </mat-option>
                  <mat-option *ngIf="options.length === 0 && ((illGroup.get('doctorCity')?.value || '').length >= 4)" disabled>
                    Keine Treffer
                  </mat-option>
                </ng-container>
              </mat-autocomplete>
              <mat-error *ngIf="illGroup.get('doctorCity')?.touched && illGroup.get('doctorCity')?.hasError('required')">
                Erforderlich
              </mat-error>
            </mat-form-field>
          </div>

        </div> <!-- end condition-entry -->
      </div> <!-- end conditions list -->

      <!-- Add-illness button INSIDE this panel -->
      <div class="panel-actions">
        <button mat-flat-button color="primary" class="add-condition-btn" (click)="addIllness()">
          + Krankheit erfassen
        </button>
      </div>

    </div> <!-- /#illBlock -->
  </div>

  <!-- NEXT button: only visible if this is the current step -->
  <div class="panel-actions" *ngIf="currentStep === 3 && !isStepDone(3)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(3)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>

  
<!-- QUESTION 4 -->
<mat-expansion-panel *ngIf="maxStep  >= 4" [expanded]="currentStep === 4">
  <mat-expansion-panel-header>
    <mat-panel-title>4. Behandlungen - durchgefuhrte oder geplante Spitalaufenthalte/Operationen</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">
    <!-- Toggle group for Yes/No -->
    <mat-button-toggle-group
      formControlName="treatments"
      class="med-toggle-group"
      [class.selected]="form.get('treatments')?.value !== null"
      aria-label="Behandlungen Ja/Nein"
    >
      <mat-button-toggle value="no">Nein</mat-button-toggle>
      <mat-button-toggle value="yes">Ja</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error
      class="toggle-error"
      *ngIf="form.get('treatments')!.hasError('required') && form.get('treatments')!.touched && currentStep === 4"
    >
      Bitte Ja oder Nein auswählen
    </mat-error>

    <!-- conditional content inside same wrapper -->
    <!-- was: <ng-container *ngIf="form.get('treatments')?.value === 'yes'"> -->
    <div #treatBlock *ngIf="form.get('treatments')?.value === 'yes'">

      <p class="subtitle">
        Haben Sie sich in den letzten fl.inf Jahren einer Operation unterzogen, fand ein Spitalaufenthalt statt oder 
        haben Sie sich einer (medizinischen oder therapeutischen) Behandlung unterzogen 
        oder beabsichtigen Sie, sich einer Konsultation, Behandlung oder Operation zu unterziehen?
      </p>

      <!-- a) Hospital Treatment -->
      <p class="subtitle"><b>a)</b> In einem Spital, einer Kureinrichtung oder einer Entzugsklinik?</p>
      <mat-button-toggle-group
        formControlName="hospitalTreatment"
        class="med-toggle-group"
        [class.selected]="form.get('hospitalTreatment')?.value !== null"
        aria-label="Spital?"
      >
        <mat-button-toggle value="no">Nein</mat-button-toggle>
        <mat-button-toggle value="yes">Ja</mat-button-toggle>
      </mat-button-toggle-group>
      <mat-error *ngIf="form.get('hospitalTreatment')?.touched && form.get('hospitalTreatment')?.hasError('required')">
        Bitte auswählen
      </mat-error>

      <!-- b) Doctor Treatment -->
      <p class="subtitle"><b>b)</b> Bei einem Arzt, Physiotherapeuten oder Chiropraktiker?</p>
      <mat-button-toggle-group
        formControlName="doctorTreatment"
        class="med-toggle-group"
        [class.selected]="form.get('doctorTreatment')?.value !== null"
        aria-label="Arzt?"
      >
        <mat-button-toggle value="no">Nein</mat-button-toggle>
        <mat-button-toggle value="yes">Ja</mat-button-toggle>
      </mat-button-toggle-group>
      <mat-error *ngIf="form.get('doctorTreatment')?.touched && form.get('doctorTreatment')?.hasError('required')">
        Bitte auswählen
      </mat-error>

      <!-- Repeatable Treatment Details -->
      <div formArrayName="treatmentDetails" class="conditions-list">
        <div
          *ngFor="let treatGroup of treatmentDetailsArray.controls; let i = index"
          [formGroupName]="i"
          class="condition-entry"
          #treatEntry
        >
          <!-- Header with remove -->
          <div class="condition-header">
            <h3 class="condition-title">{{ i + 1 }}) Krankheit erfassen</h3>
            <a *ngIf="i > 0" mat-button color="warn" class="remove-btn" (click)="removeTreatment(i)">– Entfernen</a>
          </div>

          <!-- Subtitle -->
          <p class="subtitle">
            Krankheit, Leiden, Unfall, Behandlungsgrund, betroffene Stelle am Körper (links, rechts)
          </p>

          <!-- Description textarea -->
          <div class="field-row">
            <mat-form-field
              appearance="outline"
              [class.filled]="!!treatGroup.get('description')?.value"
              class="full-row"
            >
              <span matPrefix class="prefix-spacer"></span>
              <input
                matInput
                formControlName="description"
                placeholder="Ihre Eingabe"
                type="text"
              />
              <mat-error *ngIf="
                treatGroup.get('description')!.touched
                && treatGroup.get('description')!.hasError('required')
              ">
                Erforderlich
              </mat-error>
            </mat-form-field>
          </div>

          <!-- Date pickers -->
          <div class="field-row">
            <!-- Beginn -->
            <div class="date-field">
              <p class="subtitle">Beginndatum</p>
              <mat-form-field appearance="outline" [class.filled]="!!treatGroup.get('startDate')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input
                  matInput
                  [matDatepicker]="startPicker"
                  formControlName="startDate"
                  placeholder="MM.TT.JJJJ"
                />
                <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                <mat-datepicker #startPicker></mat-datepicker>
                <mat-error *ngIf="
                  treatGroup.get('startDate')!.touched
                  && treatGroup.get('startDate')!.hasError('required')
                ">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Ende -->
            <div class="date-field">
              <p class="subtitle">Enddatum</p>
              <mat-form-field appearance="outline" [class.filled]="!!treatGroup.get('endDate')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input
                  matInput
                  [matDatepicker]="endPicker"
                  formControlName="endDate"
                  placeholder="MM.TT.JJJJ"
                />
                <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
                <mat-datepicker #endPicker></mat-datepicker>
                <mat-error *ngIf="treatGroup.get('endDate')?.touched && treatGroup.get('endDate')?.hasError('required')">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <p class="subtitle">Operiert?</p>
          <mat-button-toggle-group
            formControlName="operated"
            class="med-toggle-group"
            [class.selected]="treatGroup.get('operated')?.value !== null"
            aria-label="Operiert?"
          >
            <mat-button-toggle value="no">Nein</mat-button-toggle>
            <mat-button-toggle value="yes">Ja</mat-button-toggle>
          </mat-button-toggle-group>
          <mat-error class="toggle-error"
                     *ngIf="treatGroup.get('operated')!.invalid && treatGroup.get('operated')!.touched">
            Bitte Ja oder Nein auswählen
          </mat-error>

          <!-- Genesen? -->
          <p class="subtitle">Behandlung beendet, genesen ohne Folgen</p>
          <mat-button-toggle-group
            formControlName="recovered"
            class="med-toggle-group"
            [class.selected]="treatGroup.get('recovered')?.value !== null"
            aria-label="Genesen?"
          >
            <mat-button-toggle value="no">Nein</mat-button-toggle>
            <mat-button-toggle value="yes">Ja</mat-button-toggle>
          </mat-button-toggle-group>
          <mat-error class="toggle-error"
                     *ngIf="treatGroup.get('recovered')!.invalid && treatGroup.get('recovered')!.touched">
            Bitte Ja oder Nein auswählen
          </mat-error>

          <!-- Arztadresse -->
          <p class="subtitle">Name und Adresse des Arztes, Spitals oder anderen Leistungserbringers</p>
          <div class="field-row">
            <!-- Name -->
            <div>
              <mat-form-field appearance="outline" [class.filled]="!!treatGroup.get('doctorName')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input matInput formControlName="doctorName" placeholder="Name" />
                <mat-error *ngIf="treatGroup.get('doctorName')?.touched && treatGroup.get('doctorName')?.hasError('required')">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>

            <!-- Straße -->
            <div>
              <mat-form-field appearance="outline" [class.filled]="!!treatGroup.get('doctorLastName')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input matInput formControlName="doctorLastName" placeholder="Straße" />
                <mat-error *ngIf="treatGroup.get('doctorLastName')?.touched && treatGroup.get('doctorLastName')?.hasError('required')">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <div class="field-row address-row">
            <div>
              <mat-form-field appearance="outline" class="street-col" [class.filled]="!!treatGroup.get('doctorStreet')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input matInput formControlName="doctorStreet" placeholder="Doktorstrasse" />
                <mat-error *ngIf="
                  treatGroup.get('doctorStreet')!.touched
                  && treatGroup.get('doctorStreet')!.hasError('required')
                ">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>
            <div>
              <mat-form-field appearance="outline" class="number-col" [class.filled]="!!treatGroup.get('doctorStreetNo')?.value">
                <span matPrefix class="prefix-spacer"></span>
                <input
                  matInput
                  type="number"
                  formControlName="doctorStreetNo"
                  placeholder="Nr."
                  min="1" step="1" inputmode="numeric" pattern="\d*"
                  (keydown)="blockBadKeys($event)"
                  (paste)="blockBadPaste($event)"
                />
                <mat-error *ngIf="
                  treatGroup.get('doctorStreetNo')!.touched
                  && treatGroup.get('doctorStreetNo')!.hasError('required')
                ">
                  Erforderlich
                </mat-error>
              </mat-form-field>
            </div>
          </div>

          <div class="field-row">
            <mat-form-field appearance="outline" [class.filled]="!!treatGroup.get('doctorCity')?.value" class="full-row">
              <span matPrefix class="prefix-spacer"></span>
              <input
                matInput
                formControlName="doctorCity"
                placeholder="PLZ"
                type="text"
                [matAutocomplete]="plzAuto"
                inputmode="text"
                pattern="\d*"
              />
              <mat-autocomplete
                #plzAuto="matAutocomplete"
                [displayWith]="plzDisplay"
                (optionSelected)="treatGroup.get('doctorCity')?.setValue($event.option.value)"
              >
                <ng-container *ngIf="plzOptionsTreat$[i] | async as options">
                  <mat-option *ngFor="let z of options" [value]="z">
                    {{ z.code }} — {{ z.place }} <span *ngIf="z.state">({{ z.state }})</span>
                  </mat-option>
                  <mat-option *ngIf="options.length === 0 && ((treatGroup.get('doctorCity')?.value || '').length >= 4)" disabled>
                    Keine Treffer
                  </mat-option>
                </ng-container>
              </mat-autocomplete>
              <mat-error *ngIf="treatGroup.get('doctorCity')?.touched && treatGroup.get('doctorCity')?.hasError('required')">
                Erforderlich
              </mat-error>
            </mat-form-field>
          </div>

        </div> <!-- end condition-entry -->
      </div> <!-- end conditions list -->

      <div class="panel-actions">
        <button mat-flat-button color="primary" class="add-condition-btn" (click)="addTreatment()">
          + Krankheit erfassen
        </button>
      </div>

      <!-- Psychologist Treatment -->
      <p class="subtitle"><b>c)</b> Bei einem Psychiater, Psychologen oder Psychotherapeuten</p>
      <mat-button-toggle-group
        formControlName="treatmentPsychologist"
        class="med-toggle-group"
        [class.selected]="form.get('treatmentPsychologist')?.value !== null"
        aria-label="Spital?"
      >
        <mat-button-toggle value="no">Nein</mat-button-toggle>
        <mat-button-toggle value="yes">Ja</mat-button-toggle>
      </mat-button-toggle-group>
      <mat-error *ngIf="form.get('treatmentPsychologist')?.touched && form.get('treatmentPsychologist')?.hasError('required')">
        Bitte auswählen
      </mat-error>

      <!-- Alternative Treatment -->
      <p class="subtitle"><b>d)</b> Bei einem Naturheilpraktiker, einem nichtmedizinischen Therapeuten, einem Therapeuten für Naturheilkunde oder einem Osteopathen</p>
      <mat-button-toggle-group
        formControlName="treatmentAlternative"
        class="med-toggle-group"
        [class.selected]="form.get('treatmentAlternative')?.value !== null"
        aria-label="Arzt?"
      >
        <mat-button-toggle value="no">Nein</mat-button-toggle>
        <mat-button-toggle value="yes">Ja</mat-button-toggle>
      </mat-button-toggle-group>
      <mat-error *ngIf="form.get('treatmentAlternative')?.touched && form.get('treatmentAlternative')?.hasError('required')">
        Bitte auswählen
      </mat-error>

    </div> <!-- /#treatBlock -->
  </div>

  <div class="panel-actions" *ngIf="currentStep === 4 && !isStepDone(4)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(4)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>



<!-- QUESTION 5 -->
<mat-expansion-panel *ngIf="maxStep  >= 5" [expanded]="currentStep === 5">
  <mat-expansion-panel-header>
    <mat-panel-title>5. Arzt</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content" [formGroupName]="'doctorInfo'">

    <p class="subtitle">
      Name und Adresse des Arztes, den Sie gewöhnlich aufsuchen:
    </p>

    <div class="field-row">
      <div>
        <mat-form-field appearance="outline" [class.filled]="!!form.get('doctorInfo.doctorName')?.value">
          <span matPrefix class="prefix-spacer"></span>
          <input matInput formControlName="doctorName" placeholder="Name" />
          <mat-error *ngIf="form.get('doctorInfo.doctorName')?.touched && form.get('doctorInfo.doctorName')?.hasError('required')">
            Erforderlich
          </mat-error>
        </mat-form-field>
      </div>

      <div>
        <mat-form-field appearance="outline" [class.filled]="!!form.get('doctorInfo.doctorLastName')?.value">
          <span matPrefix class="prefix-spacer"></span>
          <input matInput formControlName="doctorLastName" placeholder="Straße" />
          <mat-error *ngIf="form.get('doctorInfo.doctorLastName')?.touched && form.get('doctorInfo.doctorLastName')?.hasError('required')">
            Erforderlich
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <div class="field-row address-row">
      <div>
        <mat-form-field appearance="outline" class="street-col" [class.filled]="!!form.get('doctorInfo.doctorStreet')?.value">
          <span matPrefix class="prefix-spacer"></span>
          <input matInput formControlName="doctorStreet" placeholder="Doktorstrasse" />
          <mat-error *ngIf="form.get('doctorInfo.doctorStreet')?.touched && form.get('doctorInfo.doctorStreet')?.hasError('required')">
            Erforderlich
          </mat-error>
        </mat-form-field>
      </div>
      <div>
        <mat-form-field appearance="outline" class="number-col" [class.filled]="!!form.get('doctorInfo.doctorStreetNo')?.value">
          <span matPrefix class="prefix-spacer"></span>
          <input
              matInput
              type="number"
              formControlName="doctorStreetNo"
              placeholder="Nr."
              min="1" step="1" inputmode="numeric" pattern="\d*"
              (keydown)="blockBadKeys($event)"
              (paste)="blockBadPaste($event)"
            />
          <mat-error *ngIf="form.get('doctorInfo.doctorStreetNo')?.touched && form.get('doctorInfo.doctorStreetNo')?.hasError('required')">
            Erforderlich
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <div class="field-row">
      <mat-form-field appearance="outline" class="full-row" [class.filled]="!!form.get('doctorInfo.doctorCity')?.value">
        <span matPrefix class="prefix-spacer"></span>
        <input
          matInput
          formControlName="doctorCity"
          placeholder="PLZ"
          type="text"
          [matAutocomplete]="plzAutoDoc"
          inputmode="text"
          pattern="\d*"
        />

        <mat-autocomplete
          #plzAutoDoc="matAutocomplete"
          [displayWith]="plzDisplay"
          (optionSelected)="form.get('doctorInfo.doctorCity')?.setValue($event.option.value)"
        >
          <ng-container *ngIf="plzOptionsDoc$ | async as options">
            <mat-option *ngFor="let z of options" [value]="z">
              {{ z.code }} — {{ z.place }} <span *ngIf="z.state">({{ z.state }})</span>
            </mat-option>
            <mat-option
              *ngIf="options.length === 0 && ((form.get('doctorInfo.doctorCity')?.value || '').length >= 4)"
              disabled
            >
              Keine Treffer
            </mat-option>
          </ng-container>
        </mat-autocomplete>

        <mat-error *ngIf="form.get('doctorInfo.doctorCity')?.touched && form.get('doctorInfo.doctorCity')?.hasError('required')">
          Erforderlich
        </mat-error>
      </mat-form-field>
    </div>


  </div>

  <div class="panel-actions" *ngIf="currentStep === 5 && !isStepDone(5)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(5)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>


<!-- QUESTION 6 -->
<mat-expansion-panel *ngIf="maxStep  >= 6" [expanded]="currentStep === 6">
  <mat-expansion-panel-header>
    <mat-panel-title>6. Bericht Hochladen</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">
    <p class="subtitle">
      Lade bitte deine vorhandenen Berichte wie Operationsbericht, Austrittsbericht oder Arztbericht hoch.
    </p>

    <!-- Upload area -->
    <div
      class="upload-container"
      [ngClass]="{ 'uploaded': form.get('reportUpload')?.value?.name }"
      (click)="fileInput.click()"
    >
      <ng-container *ngIf="form.get('reportUpload')?.value?.name; else placeholder">
        <mat-icon>cloud_upload</mat-icon>
        <span>{{ form.get('reportUpload')?.value.name }}</span>
      </ng-container>

      <ng-template #placeholder>
        <mat-icon>cloud_upload</mat-icon>
        <span>Upload</span>
      </ng-template>

      <input
        #fileInput
        type="file"
        (change)="onFileSelected($event)"
        accept=".pdf,.doc,.docx,.png,.jpg,.jpeg"
        hidden
      />
    </div>

    <mat-error class="toggle-error"
      *ngIf="form.get('reportUpload')?.touched && form.get('reportUpload')?.hasError('required')">
      Erforderlich
    </mat-error>
  </div>

  <div class="panel-actions" *ngIf="currentStep === 6 && !isStepDone(6)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(6)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>

<!-- Section title between Q6 and Q7 (not in a panel) -->
<div class="section-header" *ngIf="maxStep >= 7">
  <span class="section-pill">Dental Fragen</span>
</div>


<!-- QUESTIOONNN 7 -->
<mat-expansion-panel *ngIf="maxStep  >= 7" [expanded]="currentStep === 7">
  <mat-expansion-panel-header>
    <mat-panel-title>7. Zustand des Zahnbetts:</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">

    <mat-button-toggle-group
      formControlName="gumCondition"
      class="med-toggle-group"
      [class.selected]="form.get('gumCondition')?.value !== null"
      aria-label="Zahnfleischzustand"
    >
      <mat-button-toggle value="gut">Gut</mat-button-toggle>
      <mat-button-toggle value="mangelhaft">Mangelhaft</mat-button-toggle>
      <mat-button-toggle value="schlecht">Schlecht</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error
      class="toggle-error"
      *ngIf="form.get('gumCondition')!.hasError('required') && form.get('gumCondition')!.touched && currentStep === 7"
    >
      Bitte auswählen: Gut, Mangelhaft oder Schlecht
    </mat-error>

    <!-- CONDITIONAL TEXT INPUT -->
    <ng-container *ngIf="form.get('gumCondition')?.value === 'mangelhaft' || form.get('gumCondition')?.value === 'schlecht'">
      <p class="subtitle">Falls mangelhaft oder schlecht, bitte Stelle präzisieren:</p>

      <div class="field-row">
        <mat-form-field
          appearance="outline"
          class="full-row"
          [class.filled]="!!form.get('gumLocation')?.value"
        >
          <span matPrefix class="prefix-spacer"></span>
          <input
            matInput
            formControlName="gumLocation"
            placeholder="Hier eingeben..."
            type="text"
          />
          <mat-error *ngIf="
            form.get('gumLocation')!.touched &&
            form.get('gumLocation')!.hasError('required')
          ">
            Erforderlich
          </mat-error>
        </mat-form-field>
      </div>
    </ng-container>

  </div>

  <div class="panel-actions" *ngIf="currentStep === 7 && !isStepDone(7)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(7)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>


<!--QUESTIOOOONNN 8-->
<mat-expansion-panel *ngIf="maxStep  >= 8" [expanded]="currentStep === 8">
  <mat-expansion-panel-header>
    <mat-panel-title>8. Hygiene:</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">
    <mat-button-toggle-group
      formControlName="hygiene"
      class="med-toggle-group"
      [class.selected]="form.get('hygiene')?.value !== null"
      aria-label="Zahnfleischzustand"
    >
      <mat-button-toggle value="gut">Gut</mat-button-toggle>
      <mat-button-toggle value="mangelhaft">Mangelhaft</mat-button-toggle>
      <mat-button-toggle value="schlecht">Schlecht</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error
      class="toggle-error"
      *ngIf="form.get('hygiene')!.hasError('required') && form.get('hygiene')!.touched && currentStep === 8"
    >
      Bitte auswählen: Gut, Mangelhaft oder Schlecht
    </mat-error>
  </div>

  <div class="panel-actions" *ngIf="currentStep === 8 && !isStepDone(8)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(8)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>


<!--QUESTIOOOONNN 9-->
<mat-expansion-panel *ngIf="maxStep  >= 9" [expanded]="currentStep === 9">
  <mat-expansion-panel-header>
    <mat-panel-title>9. Okklusion:</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">

    <mat-button-toggle-group
      formControlName="occlusion"
      class="med-toggle-group"
      [class.selected]="form.get('occlusion')?.value !== null"
      aria-label="Zahnfleischzustand"
    >
      <mat-button-toggle value="klasse1">Klasse I</mat-button-toggle>
      <mat-button-toggle value="klasse2">Klasse II</mat-button-toggle>
      <mat-button-toggle value="klasse3">Klasse III</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error
      class="toggle-error"
      *ngIf="form.get('occlusion')!.hasError('required') && form.get('occlusion')!.touched && currentStep === 9"
    >
      Bitte auswählen: Gut, Mangelhaft oder Schlecht
    </mat-error>

  </div>

  <div class="panel-actions" *ngIf="currentStep === 9 && !isStepDone(9)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(9)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>


<mat-expansion-panel *ngIf="maxStep  >= 10" [expanded]="currentStep === 10">
  <mat-expansion-panel-header>
    <mat-panel-title>10. Zustand der Kronen:</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">

    <mat-button-toggle-group
      formControlName="crownCondition"
      class="med-toggle-group"
      [class.selected]="form.get('crownCondition')?.value !== null"
      aria-label="Zahnfleischzustand"
    >
      <mat-button-toggle value="keine">Keine</mat-button-toggle>
      <mat-button-toggle value="gut">Gut</mat-button-toggle>
      <mat-button-toggle value="mangelhaft">Mangelhaft</mat-button-toggle>
      <mat-button-toggle value="schlecht">Schlecht</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error
      class="toggle-error"
      *ngIf="form.get('crownCondition')!.hasError('required') && form.get('crownCondition')!.touched && currentStep === 10"
    >
      Bitte auswählen: Gut, Mangelhaft oder Schlecht
    </mat-error>

    <!-- CONDITIONAL TEXT INPUT -->
    <!-- CHANGED: ng-container -> div with #crownBlock so we can scroll to it -->
    <div #crownBlock *ngIf="form.get('crownCondition')?.value === 'mangelhaft' || form.get('crownCondition')?.value === 'schlecht'">
      <p class="subtitle">Art und Stelle:</p>

      <div class="field-row">
        <mat-form-field
          appearance="outline"
          class="full-row"
          [class.filled]="!!form.get('crownLocation')?.value"
        >
          <span matPrefix class="prefix-spacer"></span>
          <input
            matInput
            formControlName="crownLocation"
            placeholder="Hier eingeben..."
            type="text"
          />
          <mat-error *ngIf="
            form.get('crownLocation')!.touched &&
            form.get('crownLocation')!.hasError('required')
          ">
            Erforderlich
          </mat-error>
        </mat-form-field>
      </div>
    </div>

  </div>

  <div class="panel-actions" *ngIf="currentStep === 10 && !isStepDone(10)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(10)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>



<!-- QUESTION 11 -->
<mat-expansion-panel *ngIf="maxStep  >= 11" [expanded]="currentStep === 11">
  <mat-expansion-panel-header>
    <mat-panel-title>11. Zustand der Brücken:</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">

    <mat-button-toggle-group
      formControlName="bridgeCondition"
      class="med-toggle-group"
      [class.selected]="form.get('bridgeCondition')?.value !== null"
      aria-label="Zahnfleischzustand"
    >
      <mat-button-toggle value="keine">Keine</mat-button-toggle>
      <mat-button-toggle value="gut">Gut</mat-button-toggle>
      <mat-button-toggle value="mangelhaft">Mangelhaft</mat-button-toggle>
      <mat-button-toggle value="schlecht">Schlecht</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error
      class="toggle-error"
      *ngIf="form.get('bridgeCondition')!.hasError('required') && form.get('bridgeCondition')!.touched && currentStep === 11"
    >
      Bitte auswählen: Gut, Mangelhaft oder Schlecht
    </mat-error>

    <!-- CONDITIONAL TEXT INPUT -->
    <!-- CHANGED: ng-container -> div with #bridgeBlock to allow scrolling -->
    <div #bridgeBlock *ngIf="form.get('bridgeCondition')?.value === 'mangelhaft' || form.get('bridgeCondition')?.value === 'schlecht'">
      <p class="subtitle">Art und Stelle:</p>

      <div class="field-row">
        <mat-form-field
          appearance="outline"
          class="full-row"
          [class.filled]="!!form.get('bridgeLocation')?.value"
        >
          <span matPrefix class="prefix-spacer"></span>
          <input
            matInput
            formControlName="bridgeLocation"
            placeholder="Hier eingeben..."
            type="text"
          />
          <mat-error *ngIf="
            form.get('bridgeLocation')!.touched &&
            form.get('bridgeLocation')!.hasError('required')
          ">
            Erforderlich
          </mat-error>
        </mat-form-field>
      </div>
    </div>

  </div>

  <div class="panel-actions" *ngIf="currentStep === 11 && !isStepDone(11)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(11)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>



<!-- QUESTION 12 -->
<mat-expansion-panel *ngIf="maxStep  >= 12" [expanded]="currentStep === 12">
  <mat-expansion-panel-header>
    <mat-panel-title>12. Zustand der Teilprothesen:</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">

    <mat-button-toggle-group
      formControlName="denturesCondition"
      class="med-toggle-group"
      [class.selected]="form.get('denturesCondition')?.value !== null"
      aria-label="Zahnfleischzustand"
    >
      <mat-button-toggle value="keine">Keine</mat-button-toggle>
      <mat-button-toggle value="gut">Gut</mat-button-toggle>
      <mat-button-toggle value="mangelhaft">Mangelhaft</mat-button-toggle>
      <mat-button-toggle value="schlecht">Schlecht</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error
      class="toggle-error"
      *ngIf="form.get('denturesCondition')!.hasError('required') && form.get('denturesCondition')!.touched && currentStep === 12"
    >
      Bitte auswählen: Gut, Mangelhaft oder Schlecht
    </mat-error>

    <!-- CONDITIONAL TEXT INPUT -->
    <!-- CHANGED: ng-container -> div with #denturesBlock to allow scrolling -->
    <div #denturesBlock *ngIf="form.get('denturesCondition')?.value === 'mangelhaft' || form.get('denturesCondition')?.value === 'schlecht'">
      <p class="subtitle">Art und Stelle:</p>

      <div class="field-row">
        <mat-form-field
          appearance="outline"
          class="full-row"
          [class.filled]="!!form.get('denturesLocation')?.value"
        >
          <span matPrefix class="prefix-spacer"></span>
          <input
            matInput
            formControlName="denturesLocation"
            placeholder="Hier eingeben..."
            type="text"
          />
          <mat-error *ngIf="
            form.get('denturesLocation')!.touched &&
            form.get('denturesLocation')!.hasError('required')
          ">
            Erforderlich
          </mat-error>
        </mat-form-field>
      </div>
    </div>

  </div>

  <div class="panel-actions" *ngIf="currentStep === 12 && !isStepDone(12)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(12)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>



<!-- QUESTIOONNN 13 -->
<mat-expansion-panel *ngIf="maxStep  >= 13" [expanded]="currentStep === 13">
  <mat-expansion-panel-header>
    <mat-panel-title>
      13. Dentition: Hat der Versicherte eine Fehl- oder Missbildung oder einen Stellungsfehler der Zahne?
    </mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">

    <mat-button-toggle-group
      formControlName="dentalAnomaly"
      class="med-toggle-group"
      [class.selected]="form.get('dentalAnomaly')?.value !== null"
      aria-label="Zahnfleischzustand"
    >
      <mat-button-toggle value="no">Nein</mat-button-toggle>
      <mat-button-toggle value="yes">Ja</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error
      class="toggle-error"
      *ngIf="form.get('dentalAnomaly')!.hasError('required') && form.get('dentalAnomaly')!.touched && currentStep === 13"
    >
      Bitte auswählen: Nein oder Ja
    </mat-error>

    <!-- CONDITIONAL TEXT INPUT (use a real element so we can scroll to it) -->
    <div #dentalAnomalyBlock *ngIf="form.get('dentalAnomaly')?.value === 'yes'">
      <p class="subtitle">Wenn ja, welche?</p>

      <div class="field-row">
        <mat-form-field
          appearance="outline"
          class="full-row"
          [class.filled]="!!form.get('dentalAnomalyDeetz')?.value"
        >
          <span matPrefix class="prefix-spacer"></span>
          <input
            matInput
            formControlName="dentalAnomalyDeetz"
            placeholder="Hier eingeben..."
            type="text"
          />
          <mat-error *ngIf="
            form.get('dentalAnomalyDeetz')!.touched &&
            form.get('dentalAnomalyDeetz')!.hasError('required')
          ">
            Erforderlich
          </mat-error>
        </mat-form-field>
      </div>
    </div>

  </div>

  <div class="panel-actions" *ngIf="currentStep === 13 && !isStepDone(13)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(13)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>



<!-- QUESTION 14 -->
<mat-expansion-panel *ngIf="maxStep  >= 14" [expanded]="currentStep === 14">
  <mat-expansion-panel-header>
    <mat-panel-title>
      14. Kiefer: Hat der Versicherte eine Fehl- oder Missbildung oder einen Stellungsfehler des Kiefers?
    </mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">
    <!-- Yes/No -->
    <mat-button-toggle-group
      formControlName="jawDeformity"
      class="med-toggle-group"
      [class.selected]="form.get('jawDeformity')?.value !== null"
      aria-label="Kieferdeformität Ja/Nein"
    >
      <mat-button-toggle value="no">Nein</mat-button-toggle>
      <mat-button-toggle value="yes">Ja</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error class="toggle-error"
      *ngIf="form.get('jawDeformity')!.hasError('required') && form.get('jawDeformity')!.touched && currentStep === 14">
      Bitte Ja oder Nein auswählen
    </mat-error>

    <!-- CONDITIONAL DETAILS -->
    <ng-container *ngIf="form.get('jawDeformity')?.value === 'yes'">
      <div #jawBlock>
        <p class="subtitle">Wenn ja, welche?</p>

        <div class="field-row">
          <mat-form-field
            appearance="outline"
            class="full-row"
            [class.filled]="!!form.get('jawDeformityDeetz')?.value"
          >
            <span matPrefix class="prefix-spacer"></span>
            <input
              matInput
              formControlName="jawDeformityDeetz"
              placeholder="Hier eingeben..."
              type="text"
            />
            <mat-error *ngIf="
              form.get('jawDeformityDeetz')!.touched &&
              form.get('jawDeformityDeetz')!.hasError('required')
            ">
              Erforderlich
            </mat-error>
          </mat-form-field>
        </div>
      </div>
    </ng-container>
  </div>

  <div class="panel-actions" *ngIf="currentStep === 14 && !isStepDone(14)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(14)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>



<!-- QUESTION 15 -->
<mat-expansion-panel *ngIf="maxStep  >= 15" [expanded]="currentStep === 15">
  <mat-expansion-panel-header>
    <mat-panel-title>
      15. Leidet der Versicherte an einer Krankheit, die den Zustand der Zähne in Zukunft beeinflussen könnte?
    </mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">
    <mat-button-toggle-group
      formControlName="toothIllness"
      class="med-toggle-group"
      [class.selected]="form.get('toothIllness')?.value !== null"
      aria-label="Krankheit beeinflusst Zähne (Ja/Nein)"
    >
      <mat-button-toggle value="no">Nein</mat-button-toggle>
      <mat-button-toggle value="yes">Ja</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error
      class="toggle-error"
      *ngIf="form.get('toothIllness')!.hasError('required') && form.get('toothIllness')!.touched && currentStep === 15"
    >
      Bitte Ja oder Nein auswählen
    </mat-error>

    <!-- CONDITIONAL TEXT INPUT -->
    <ng-container *ngIf="form.get('toothIllness')?.value === 'yes'">
      <div #toothIllnessBlock>
        <p class="subtitle">Wenn ja, welche?</p>

        <div class="field-row">
          <mat-form-field
            appearance="outline"
            class="full-row"
            [class.filled]="!!form.get('toothIllnessDeetz')?.value"
          >
            <span matPrefix class="prefix-spacer"></span>
            <input
              matInput
              formControlName="toothIllnessDeetz"
              placeholder="Hier eingeben..."
              type="text"
            />
            <mat-error *ngIf="
              form.get('toothIllnessDeetz')!.touched &&
              form.get('toothIllnessDeetz')!.hasError('required')
            ">
              Erforderlich
            </mat-error>
          </mat-form-field>
        </div>
      </div>
    </ng-container>
  </div>

  <div class="panel-actions" *ngIf="currentStep === 15 && !isStepDone(15)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(15)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>




<!-- QUESTIOONNN 16 -->

<mat-expansion-panel *ngIf="maxStep  >= 16" [expanded]="currentStep === 16">
  <mat-expansion-panel-header>
    <mat-panel-title>16. Fehlende, nicht ersetzte Zähne:</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">

    <mat-button-toggle-group
      formControlName="missingTeeth"
      class="med-toggle-group"
      [class.selected]="form.get('missingTeeth')?.value !== null"
      aria-label="Zahnfleischzustand"
    >
      <mat-button-toggle value="no">Nein</mat-button-toggle>
      <mat-button-toggle value="yes">Ja</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error
      class="toggle-error"
      *ngIf="form.get('missingTeeth')!.hasError('required') && form.get('missingTeeth')!.touched && currentStep === 16"
    >
      Bitte auswählen: Nein oder Ja
    </mat-error>

    <!-- TOOTH CHART -->
    <div #chart16 class="tooth-chart" *ngIf="form.get('missingTeeth')?.value === 'yes'">
      <!-- First Row (55–51) -->

      <!-- Tooth numbers -->
      <div class="tooth-number-row">
        <div
          *ngFor="let tooth of [55, 54, 53, 52, 51]"
          class="tooth-number-label"
          [ngClass]="{ 'selected': isToothSelected(tooth) }"
        >
          {{ tooth }}
        </div>
      </div>

      <!-- Tooth boxes -->
      <div class="tooth-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair(pair1A, pair1B) }">
        <div
          *ngFor="let tooth of [55, 54, 53, 52, 51]"
          class="tooth-box"
          [ngClass]="{ 'selected': isToothSelected(tooth) }"
          (click)="toggleTooth(tooth)"
        >
          <mat-icon *ngIf="isToothSelected(tooth)">check</mat-icon>
        </div>
      </div>

      <!-- Error below the row -->
      <mat-error class="tooth-error" *ngIf="
        form.get('missingTeethList')!.touched &&
        form.get('missingTeethList')!.hasError('required')
      ">
        Bitte einen Zahn auswählen.
      </mat-error>

      <!-- Second Row (85–81) -->
      <div class="tooth-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair(pair1A, pair1B) }">
        <div *ngFor="let tooth of [85, 84, 83, 82, 81]"
             class="tooth-box"
             [class.selected]="isToothSelected(tooth)"
             (click)="toggleTooth(tooth)">
          <mat-icon *ngIf="isToothSelected(tooth)">check</mat-icon>
        </div>
      </div>

      <div class="second-tooth-number-row">
        <div *ngFor="let tooth of [85, 84, 83, 82, 81]"
             class="tooth-number-label"
             [ngClass]="{ 'selected': isToothSelected(tooth) }">
          {{ tooth }}
        </div>
      </div>

      <mat-error class="tooth-error" *ngIf="
        form.get('missingTeethList')!.touched &&
        form.get('missingTeethList')!.hasError('required')
      ">
        Bitte einen Zahn auswählen.
      </mat-error>

      <!-- 3A. THIRD ROW -->
      <div class="tooth-row-wrapper">
        <!-- Number row -->
        <div class="number-row">
          <ng-container *ngFor="let tooth of [18, 17, 16, 15, 14, 13, 12, 11]">
            <div class="number-label" [ngClass]="{ 'selected': isToothSelected(tooth) }">{{ tooth }}</div>
          </ng-container>
          <div class="vertical-divider"></div>
          <ng-container *ngFor="let tooth of [21, 22, 23, 24, 25, 26, 27, 28]">
            <div class="number-label" [ngClass]="{ 'selected': isToothSelected(tooth) }">{{ tooth }}</div>
          </ng-container>
        </div>

        <!-- One global divider -->
        <div
          class="vertical-divider top-divider"
          [ngClass]="{ 'highlighted-divider': isAnySelectedInPair(pair2A, pair2B) }"
        ></div>

        <!-- Tooth box row -->
        <div class="second-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair(pair2A, pair2B) }">
          <ng-container *ngFor="let tooth of [18, 17, 16, 15, 14, 13, 12, 11, 21, 22, 23, 24, 25, 26, 27, 28]">
            <div
              class="second-box"
              [ngClass]="{ 'selected': isToothSelected(tooth) }"
              (click)="toggleTooth(tooth)"
            >
              <mat-icon *ngIf="isToothSelected(tooth)">check</mat-icon>
            </div>
          </ng-container>
        </div>

        <mat-error class="tooth-error" *ngIf="
          form.get('missingTeethList')!.touched &&
          form.get('missingTeethList')!.hasError('required')
        ">
          Bitte einen Zahn auswählen.
        </mat-error>
      </div>

      <!-- 4A. FOURTH ROW -->
      <div class="tooth-row-wrapper">
        <!-- Tooth box row -->
        <div class="second-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair(pair2A, pair2B) }">
          <ng-container *ngFor="let tooth of [48, 47, 46, 45, 44, 43, 42, 41, 31, 32, 33, 34, 35, 36, 37, 38]">
            <div
              class="second-box"
              [ngClass]="{ 'selected': isToothSelected(tooth) }"
              (click)="toggleTooth(tooth)"
            >
              <mat-icon *ngIf="isToothSelected(tooth)">check</mat-icon>
            </div>
          </ng-container>
        </div>

        <div class="vertical-divider bottom-divider"
             [ngClass]="{ 'highlighted-divider': isAnySelectedInPair(pair2A, pair2B) }"></div>

        <!-- Number row -->
        <div class="second-number-row">
          <ng-container *ngFor="let tooth of [48, 47, 46, 45, 44, 43, 42, 41]">
            <div class="number-label" [ngClass]="{ 'selected': isToothSelected(tooth) }">{{ tooth }}</div>
          </ng-container>
          <div class="vertical-divider"></div>
          <ng-container *ngFor="let tooth of [31, 32, 33, 34, 35, 36, 37, 38]">
            <div class="number-label" [ngClass]="{ 'selected': isToothSelected(tooth) }">{{ tooth }}</div>
          </ng-container>
        </div>

        <mat-error class="tooth-error" *ngIf="
          form.get('missingTeethList')!.touched &&
          form.get('missingTeethList')!.hasError('required')
        ">
          Bitte einen Zahn auswählen.
        </mat-error>
      </div>

      <!-- 5A. FIFTH ROW -->
      <div class="tooth-number-row" [ngClass]="{ 'highlighted': isAnySelectedInPair(pair3A, pair3B) }">
        <div
          *ngFor="let tooth of [61, 62, 63, 64, 65]"
          class="tooth-number-label"
          [ngClass]="{ 'selected': isToothSelected(tooth) }"
        >
          {{ tooth }}
        </div>
      </div>

      <!-- 1B. Tooth boxes -->
      <div class="tooth-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair(pair3A, pair3B) }">
        <div
          *ngFor="let tooth of [61, 62, 63, 64, 65]"
          class="tooth-box"
          [ngClass]="{ 'selected': isToothSelected(tooth) }"
          (click)="toggleTooth(tooth)"
        >
          <mat-icon *ngIf="isToothSelected(tooth)">check</mat-icon>
        </div>
      </div>

      <mat-error class="tooth-error" *ngIf="
        form.get('missingTeethList')!.touched &&
        form.get('missingTeethList')!.hasError('required')
      ">
        Bitte einen Zahn auswählen.
      </mat-error>

      <!-- SIXTH ROOOWWW  -->
      <div class="tooth-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair(pair3A, pair3B) }">
        <div *ngFor="let tooth of [71, 72, 73, 74, 75]"
             class="tooth-box"
             [class.selected]="isToothSelected(tooth)"
             (click)="toggleTooth(tooth)">
          <mat-icon *ngIf="isToothSelected(tooth)">check</mat-icon>
        </div>
      </div>

      <div class="second-tooth-number-row">
        <div *ngFor="let tooth of [71, 72, 73, 74, 75]"
             class="tooth-number-label"
             [ngClass]="{ 'selected': isToothSelected(tooth) }">
          {{ tooth }}
        </div>
      </div>

      <mat-error class="tooth-error" *ngIf="
        form.get('missingTeethList')!.touched &&
        form.get('missingTeethList')!.hasError('required')
      ">
        Bitte einen Zahn auswählen.
      </mat-error>
    </div> <!-- end tooth-chart -->

  </div> <!-- end step-content -->

  <div class="panel-actions" *ngIf="currentStep === 16 && !isStepDone(16)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(16)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>


  
<!-- QUESTION 17 -->
<mat-expansion-panel *ngIf="maxStep  >= 17" [expanded]="currentStep === 17">
  <mat-expansion-panel-header>
    <mat-panel-title>17. Schadhafte Zahnfüllungen:</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">

    <mat-button-toggle-group
      formControlName="missingTeeth2"
      class="med-toggle-group"
      [class.selected]="form.get('missingTeeth2')?.value !== null"
      aria-label="Schadhafte Zahnfüllungen"
    >
      <mat-button-toggle value="no">Nein</mat-button-toggle>
      <mat-button-toggle value="yes">Ja</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error
      class="toggle-error"
      *ngIf="form.get('missingTeeth2')!.hasError('required') && form.get('missingTeeth2')!.touched && currentStep === 17"
    >
      Bitte auswählen: Nein oder Ja
    </mat-error>

    <!-- TOOTH CHART -->
    <div #chart17 class="tooth-chart" *ngIf="form.get('missingTeeth2')?.value === 'yes'">
      <!-- First Row (55–51) -->
      <div class="tooth-number-row">
        <div
          *ngFor="let tooth of [55, 54, 53, 52, 51]"
          class="tooth-number-label"
          [ngClass]="{ 'selected': isToothSelected2(tooth) }"
        >
          {{ tooth }}
        </div>
      </div>

      <div class="tooth-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair2(pair1A, pair1B)}">
        <div
          *ngFor="let tooth of [55, 54, 53, 52, 51]"
          class="tooth-box"
          [ngClass]="{ 'selected': isToothSelected2(tooth) }"
          (click)="toggleTooth2(tooth)"
        >
          <mat-icon *ngIf="isToothSelected2(tooth)">check</mat-icon>
        </div>
      </div>

      <mat-error class="tooth-error" *ngIf="
        form.get('missingTeethList2')!.touched &&
        form.get('missingTeethList2')!.hasError('required')
      ">
        Bitte einen Zahn auswählen.
      </mat-error>

      <!-- Second Row (85–81) -->
      <div class="tooth-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair2(pair1A, pair1B) }">
        <div *ngFor="let tooth of [85, 84, 83, 82, 81]"
             class="tooth-box"
             [class.selected]="isToothSelected2(tooth)"
             (click)="toggleTooth2(tooth)">
          <mat-icon *ngIf="isToothSelected2(tooth)">check</mat-icon>
        </div>
      </div>

      <div class="second-tooth-number-row">
        <div *ngFor="let tooth of [85, 84, 83, 82, 81]" 
             class="tooth-number-label"
             [ngClass]="{ 'selected': isToothSelected2(tooth) }">
          {{ tooth }}
        </div>
      </div>

      <mat-error class="tooth-error" *ngIf="
        form.get('missingTeethList2')!.touched &&
        form.get('missingTeethList2')!.hasError('required')
      ">
        Bitte einen Zahn auswählen.
      </mat-error>

      <!-- 3A. THIRD ROW -->
      <div class="tooth-row-wrapper">
        <div class="number-row">
          <ng-container *ngFor="let tooth of [18, 17, 16, 15, 14, 13, 12, 11]">
            <div class="number-label" [ngClass]="{ 'selected': isToothSelected2(tooth) }">{{ tooth }}</div>
          </ng-container>
          <div class="vertical-divider"></div>
          <ng-container *ngFor="let tooth of [21, 22, 23, 24, 25, 26, 27, 28]">
            <div class="number-label" [ngClass]="{ 'selected': isToothSelected2(tooth) }">{{ tooth }}</div>
          </ng-container>
        </div>

        <div class="vertical-divider top-divider"
             [ngClass]="{ 'highlighted-divider': isAnySelectedInPair2(pair2A, pair2B) }"></div>

        <div class="second-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair2(pair2A, pair2B) }">
          <ng-container *ngFor="let tooth of [18, 17, 16, 15, 14, 13, 12, 11, 21, 22, 23, 24, 25, 26, 27, 28]">
            <div class="second-box"
                 [ngClass]="{ 'selected': isToothSelected2(tooth) }"
                 (click)="toggleTooth2(tooth)">
              <mat-icon *ngIf="isToothSelected2(tooth)">check</mat-icon>
            </div>
          </ng-container>
        </div>

        <mat-error class="tooth-error" *ngIf="
          form.get('missingTeethList2')!.touched &&
          form.get('missingTeethList2')!.hasError('required')
        ">
          Bitte einen Zahn auswählen.
        </mat-error>
      </div>

      <!-- 4A. FOURTH ROW -->
      <div class="tooth-row-wrapper">
        <div class="second-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair2(pair2A, pair2B) }">
          <ng-container *ngFor="let tooth of [48, 47, 46, 45, 44, 43, 42, 41, 31, 32, 33, 34, 35, 36, 37, 38]">
            <div class="second-box"
                 [ngClass]="{ 'selected': isToothSelected2(tooth) }"
                 (click)="toggleTooth2(tooth)">
              <mat-icon *ngIf="isToothSelected2(tooth)">check</mat-icon>
            </div>
          </ng-container>
        </div>

        <div class="vertical-divider bottom-divider"
             [ngClass]="{ 'highlighted-divider': isAnySelectedInPair2(pair2A, pair2B) }"></div>

        <div class="second-number-row">
          <ng-container *ngFor="let tooth of [48, 47, 46, 45, 44, 43, 42, 41]">
            <div class="number-label" [ngClass]="{ 'selected': isToothSelected2(tooth) }">{{ tooth }}</div>
          </ng-container>
          <div class="vertical-divider"></div>
          <ng-container *ngFor="let tooth of [31, 32, 33, 34, 35, 36, 37, 38]">
            <div class="number-label" [ngClass]="{ 'selected': isToothSelected2(tooth) }">{{ tooth }}</div>
          </ng-container>
        </div>

        <mat-error class="tooth-error" *ngIf="
          form.get('missingTeethList2')!.touched &&
          form.get('missingTeethList2')!.hasError('required')
        ">
          Bitte einen Zahn auswählen.
        </mat-error>
      </div>

      <!-- 5A. FIFTH ROW -->
      <div class="tooth-number-row" [ngClass]="{ 'highlighted': isAnySelectedInPair2(pair3A, pair3B) }">
        <div *ngFor="let tooth of [61, 62, 63, 64, 65]"
             class="tooth-number-label"
             [ngClass]="{ 'selected': isToothSelected2(tooth) }">
          {{ tooth }}
        </div>
      </div>

      <div class="tooth-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair2(pair3A, pair3B) }">
        <div *ngFor="let tooth of [61, 62, 63, 64, 65]"
             class="tooth-box"
             [ngClass]="{ 'selected': isToothSelected2(tooth) }"
             (click)="toggleTooth2(tooth)">
          <mat-icon *ngIf="isToothSelected2(tooth)">check</mat-icon>
        </div>
      </div>

      <mat-error class="tooth-error" *ngIf="
        form.get('missingTeethList2')!.touched &&
        form.get('missingTeethList2')!.hasError('required')
      ">
        Bitte einen Zahn auswählen.
      </mat-error>

      <!-- Sixth row -->
      <div class="tooth-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair2(pair3A, pair3B) }">
        <div *ngFor="let tooth of [71, 72, 73, 74, 75]"
             class="tooth-box"
             [ngClass]="{ 'selected': isToothSelected2(tooth) }"
             (click)="toggleTooth2(tooth)">
          <mat-icon *ngIf="isToothSelected2(tooth)">check</mat-icon>
        </div>
      </div>

      <div class="second-tooth-number-row">
        <div *ngFor="let tooth of [71, 72, 73, 74, 75]"
             class="tooth-number-label"
             [ngClass]="{ 'selected': isToothSelected2(tooth) }">
          {{ tooth }}
        </div>
      </div>

      <mat-error class="tooth-error" *ngIf="
        form.get('missingTeethList2')!.touched &&
        form.get('missingTeethList2')!.hasError('required')
      ">
        Bitte einen Zahn auswählen.
      </mat-error>
    </div> <!-- end tooth-chart -->

  </div>

  <div class="panel-actions" *ngIf="currentStep === 17 && !isStepDone(17)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(17)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>


<!-- QUESTION 18 -->
<mat-expansion-panel *ngIf="maxStep >= 18" [expanded]="currentStep === 18">
  <mat-expansion-panel-header>
    <mat-panel-title>18. Karlose Zähne:</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">

    <mat-button-toggle-group
      formControlName="missingTeeth3"
      class="med-toggle-group"
      [class.selected]="form.get('missingTeeth3')?.value !== null"
      aria-label="Zahnfleischzustand"
    >
      <mat-button-toggle value="no">Nein</mat-button-toggle>
      <mat-button-toggle value="yes">Ja</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error
      class="toggle-error"
      *ngIf="form.get('missingTeeth3')!.hasError('required') && form.get('missingTeeth3')!.touched && currentStep === 18"
    >
      Bitte auswählen: Nein oder Ja
    </mat-error>

    <!-- TOOTH CHART -->
    <div #chart18 class="tooth-chart" *ngIf="form.get('missingTeeth3')?.value === 'yes'">
      <!-- First Row (55–51) -->
      <div class="tooth-number-row">
        <div
          *ngFor="let tooth of [55, 54, 53, 52, 51]"
          class="tooth-number-label"
          [ngClass]="{ 'selected': isToothSelected3(tooth) }"
        >
          {{ tooth }}
        </div>
      </div>

      <div class="tooth-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair3(pair1A, pair1B) }">
        <div
          *ngFor="let tooth of [55, 54, 53, 52, 51]"
          class="tooth-box"
          [ngClass]="{ 'selected': isToothSelected3(tooth) }"
          (click)="toggleTooth3(tooth)"
        >
          <mat-icon *ngIf="isToothSelected3(tooth)">check</mat-icon>
        </div>
      </div>

      <mat-error class="tooth-error" *ngIf="
        form.get('missingTeethList3')!.touched &&
        form.get('missingTeethList3')!.hasError('required')
      ">
        Bitte einen Zahn auswählen.
      </mat-error>

      <!-- Second Row (85–81) -->
      <div class="tooth-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair3(pair1A, pair1B) }">
        <div *ngFor="let tooth of [85, 84, 83, 82, 81]"
             class="tooth-box"
             [class.selected]="isToothSelected3(tooth)"
             (click)="toggleTooth3(tooth)">
          <mat-icon *ngIf="isToothSelected3(tooth)">check</mat-icon>
        </div>
      </div>

      <div class="second-tooth-number-row">
        <div *ngFor="let tooth of [85, 84, 83, 82, 81]"
             class="tooth-number-label"
             [ngClass]="{ 'selected': isToothSelected3(tooth) }">
          {{ tooth }}
        </div>
      </div>

      <mat-error class="tooth-error" *ngIf="
        form.get('missingTeethList3')!.touched &&
        form.get('missingTeethList3')!.hasError('required')
      ">
        Bitte einen Zahn auswählen.
      </mat-error>

      <!-- 3A. THIRD ROW -->
      <div class="tooth-row-wrapper">
        <div class="number-row">
          <ng-container *ngFor="let tooth of [18, 17, 16, 15, 14, 13, 12, 11]">
            <div class="number-label" [ngClass]="{ 'selected': isToothSelected3(tooth) }">{{ tooth }}</div>
          </ng-container>
          <div class="vertical-divider"></div>
          <ng-container *ngFor="let tooth of [21, 22, 23, 24, 25, 26, 27, 28]">
            <div class="number-label" [ngClass]="{ 'selected': isToothSelected3(tooth) }">{{ tooth }}</div>
          </ng-container>
        </div>

        <div class="vertical-divider top-divider"
             [ngClass]="{ 'highlighted-divider': isAnySelectedInPair3(pair2A, pair2B) }"></div>

        <div class="second-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair3(pair2A, pair2B) }">
          <ng-container *ngFor="let tooth of [18, 17, 16, 15, 14, 13, 12, 11, 21, 22, 23, 24, 25, 26, 27, 28]">
            <div class="second-box"
                 [ngClass]="{ 'selected': isToothSelected3(tooth) }"
                 (click)="toggleTooth3(tooth)">
              <mat-icon *ngIf="isToothSelected3(tooth)">check</mat-icon>
            </div>
          </ng-container>
        </div>

        <mat-error class="tooth-error" *ngIf="
          form.get('missingTeethList3')!.touched &&
          form.get('missingTeethList3')!.hasError('required')
        ">
          Bitte einen Zahn auswählen.
        </mat-error>
      </div>

      <!-- 4A. FOURTH ROW -->
      <div class="tooth-row-wrapper">
        <div class="second-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair3(pair2A, pair2B) }">
          <ng-container *ngFor="let tooth of [48, 47, 46, 45, 44, 43, 42, 41, 31, 32, 33, 34, 35, 36, 37, 38]">
            <div class="second-box"
                 [ngClass]="{ 'selected': isToothSelected3(tooth) }"
                 (click)="toggleTooth3(tooth)">
              <mat-icon *ngIf="isToothSelected3(tooth)">check</mat-icon>
            </div>
          </ng-container>
        </div>

        <div class="vertical-divider bottom-divider"
             [ngClass]="{ 'highlighted-divider': isAnySelectedInPair3(pair2A, pair2B) }"></div>

        <div class="second-number-row">
          <ng-container *ngFor="let tooth of [48, 47, 46, 45, 44, 43, 42, 41]">
            <div class="number-label" [ngClass]="{ 'selected': isToothSelected3(tooth) }">{{ tooth }}</div>
          </ng-container>
          <div class="vertical-divider"></div>
          <ng-container *ngFor="let tooth of [31, 32, 33, 34, 35, 36, 37, 38]">
            <div class="number-label" [ngClass]="{ 'selected': isToothSelected3(tooth) }">{{ tooth }}</div>
          </ng-container>
        </div>

        <mat-error class="tooth-error" *ngIf="
          form.get('missingTeethList3')!.touched &&
          form.get('missingTeethList3')!.hasError('required')
        ">
          Bitte einen Zahn auswählen.
        </mat-error>
      </div>

      <!-- 5A. FIFTH ROW -->
      <div class="tooth-number-row" [ngClass]="{ 'highlighted': isAnySelectedInPair3(pair3A, pair3B) }">
        <div *ngFor="let tooth of [61, 62, 63, 64, 65]"
             class="tooth-number-label"
             [ngClass]="{ 'selected': isToothSelected3(tooth) }">
          {{ tooth }}
        </div>
      </div>

      <div class="tooth-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair3(pair3A, pair3B) }">
        <div *ngFor="let tooth of [61, 62, 63, 64, 65]"
             class="tooth-box"
             [ngClass]="{ 'selected': isToothSelected3(tooth) }"
             (click)="toggleTooth3(tooth)">
          <mat-icon *ngIf="isToothSelected3(tooth)">check</mat-icon>
        </div>
      </div>

      <mat-error class="tooth-error" *ngIf="
        form.get('missingTeethList3')!.touched &&
        form.get('missingTeethList3')!.hasError('required')
      ">
        Bitte einen Zahn auswählen.
      </mat-error>

      <!-- SIXTH ROW -->
      <div class="tooth-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair3(pair3A, pair3B) }">
        <div *ngFor="let tooth of [71, 72, 73, 74, 75]"
             class="tooth-box"
             [class.selected]="isToothSelected3(tooth)"
             (click)="toggleTooth3(tooth)">
          <mat-icon *ngIf="isToothSelected3(tooth)">check</mat-icon>
        </div>
      </div>

      <div class="second-tooth-number-row">
        <div *ngFor="let tooth of [71, 72, 73, 74, 75]"
             class="tooth-number-label"
             [ngClass]="{ 'selected': isToothSelected3(tooth) }">
          {{ tooth }}
        </div>
      </div>

      <mat-error class="tooth-error" *ngIf="
        form.get('missingTeethList3')!.touched &&
        form.get('missingTeethList3')!.hasError('required')
      ">
        Bitte einen Zahn auswählen.
      </mat-error>
    </div> <!-- /tooth-chart -->

  </div>

  <div class="panel-actions" *ngIf="currentStep === 18 && !isStepDone(18)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(18)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>



<!-- QUESTIOONNN 19 -->
<mat-expansion-panel *ngIf="maxStep >= 19" [expanded]="currentStep === 19">
  <mat-expansion-panel-header>
    <mat-panel-title>19. Wurzelbehandelte Zahne:</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">

    <mat-button-toggle-group
      formControlName="missingTeeth4"
      class="med-toggle-group"
      [class.selected]="form.get('missingTeeth4')?.value !== null"
      aria-label="Zahnfleischzustand"
    >
      <mat-button-toggle value="no">Nein</mat-button-toggle>
      <mat-button-toggle value="yes">Ja</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error
      class="toggle-error"
      *ngIf="form.get('missingTeeth4')!.hasError('required') && form.get('missingTeeth4')!.touched && currentStep === 19"
    >
      Bitte auswählen: Nein oder Ja
    </mat-error>

    <!-- TOOTH CHART -->
    <div #chart19 class="tooth-chart" *ngIf="form.get('missingTeeth4')?.value === 'yes'">
      <!-- First Row (55–51) -->

      <!-- Tooth numbers -->
      <div class="tooth-number-row">
        <div
          *ngFor="let tooth of [55, 54, 53, 52, 51]"
          class="tooth-number-label"
          [ngClass]="{ 'selected': isToothSelected4(tooth) }"
        >
          {{ tooth }}
        </div>
      </div>

      <!-- Tooth boxes -->
      <div class="tooth-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair4(pair1A, pair1B) }">
        <div
          *ngFor="let tooth of [55, 54, 53, 52, 51]"
          class="tooth-box"
          [ngClass]="{ 'selected': isToothSelected4(tooth) }"
          (click)="toggleTooth4(tooth)"
        >
          <mat-icon *ngIf="isToothSelected4(tooth)">check</mat-icon>
        </div>
      </div>

      <!-- Error below the row -->
      <mat-error class="tooth-error" *ngIf="
        form.get('missingTeethList4')!.touched &&
        form.get('missingTeethList4')!.hasError('required')
      ">
        Bitte einen Zahn auswählen.
      </mat-error>

      <!-- Second Row (85–81) -->
      <div class="tooth-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair4(pair1A, pair1B) }">
        <div *ngFor="let tooth of [85, 84, 83, 82, 81]"
             class="tooth-box"
             [class.selected]="isToothSelected4(tooth)"
             (click)="toggleTooth4(tooth)">
          <mat-icon *ngIf="isToothSelected4(tooth)">check</mat-icon>
        </div>
      </div>

      <div class="second-tooth-number-row">
        <div *ngFor="let tooth of [85, 84, 83, 82, 81]" 
             class="tooth-number-label"
             [ngClass]="{ 'selected': isToothSelected4(tooth) }">
          {{ tooth }}
        </div>
      </div>

      <mat-error class="tooth-error" *ngIf="
        form.get('missingTeethList4')!.touched &&
        form.get('missingTeethList4')!.hasError('required')
      ">
        Bitte einen Zahn auswählen.
      </mat-error>

      <!-- 3A. THIRD ROW -->
      <div class="tooth-row-wrapper">
        <!-- Number row -->
        <div class="number-row">
          <ng-container *ngFor="let tooth of [18, 17, 16, 15, 14, 13, 12, 11]">
            <div class="number-label" [ngClass]="{ 'selected': isToothSelected4(tooth) }">{{ tooth }}</div>
          </ng-container>
          <div class="vertical-divider"></div>
          <ng-container *ngFor="let tooth of [21, 22, 23, 24, 25, 26, 27, 28]">
            <div class="number-label" [ngClass]="{ 'selected': isToothSelected4(tooth) }">{{ tooth }}</div>
          </ng-container>
        </div>

        <!-- One global divider -->
        <div
          class="vertical-divider top-divider"
          [ngClass]="{ 'highlighted-divider': isAnySelectedInPair4(pair2A, pair2B) }"
        ></div>

        <!-- Tooth box row -->
        <div class="second-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair4(pair2A, pair2B) }">
          <ng-container *ngFor="let tooth of [18, 17, 16, 15, 14, 13, 12, 11, 21, 22, 23, 24, 25, 26, 27, 28]">
            <div
              class="second-box"
              [ngClass]="{ 'selected': isToothSelected4(tooth) }"
              (click)="toggleTooth4(tooth)"
            >
              <mat-icon *ngIf="isToothSelected4(tooth)">check</mat-icon>
            </div>
          </ng-container>
        </div>

        <mat-error class="tooth-error" *ngIf="
          form.get('missingTeethList4')!.touched &&
          form.get('missingTeethList4')!.hasError('required')
        ">
          Bitte einen Zahn auswählen.
        </mat-error>
      </div>

      <!-- 4A. FOURTH ROW -->
      <div class="tooth-row-wrapper">
        <!-- Tooth box row -->
        <div class="second-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair4(pair2A, pair2B) }">
          <ng-container *ngFor="let tooth of [48, 47, 46, 45, 44, 43, 42, 41, 31, 32, 33, 34, 35, 36, 37, 38]">
            <div
              class="second-box"
              [ngClass]="{ 'selected': isToothSelected4(tooth) }"
              (click)="toggleTooth4(tooth)"
            >
              <mat-icon *ngIf="isToothSelected4(tooth)">check</mat-icon>
            </div>
          </ng-container>
        </div>

        <div class="vertical-divider bottom-divider"
             [ngClass]="{ 'highlighted-divider': isAnySelectedInPair4(pair2A, pair2B) }"></div>

        <!-- Number row -->
        <div class="second-number-row">
          <ng-container *ngFor="let tooth of [48, 47, 46, 45, 44, 43, 42, 41]">
            <div class="number-label" [ngClass]="{ 'selected': isToothSelected4(tooth) }">{{ tooth }}</div>
          </ng-container>
          <div class="vertical-divider"></div>
          <ng-container *ngFor="let tooth of [31, 32, 33, 34, 35, 36, 37, 38]">
            <div class="number-label" [ngClass]="{ 'selected': isToothSelected4(tooth) }">{{ tooth }}</div>
          </ng-container>
        </div>

        <mat-error class="tooth-error" *ngIf="
          form.get('missingTeethList4')!.touched &&
          form.get('missingTeethList4')!.hasError('required')
        ">
          Bitte einen Zahn auswählen.
        </mat-error>
      </div>

      <!-- 5A. FIFTH ROW -->
      <div class="tooth-number-row" [ngClass]="{ 'highlighted': isAnySelectedInPair4(pair3A, pair3B) }">
        <div
          *ngFor="let tooth of [61, 62, 63, 64, 65]"
          class="tooth-number-label"
          [ngClass]="{ 'selected': isToothSelected4(tooth) }"
        >
          {{ tooth }}
        </div>
      </div>

      <!-- 1B. Tooth boxes -->
      <div class="tooth-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair4(pair3A, pair3B) }">
        <div
          *ngFor="let tooth of [61, 62, 63, 64, 65]"
          class="tooth-box"
          [ngClass]="{ 'selected': isToothSelected4(tooth) }"
          (click)="toggleTooth4(tooth)"
        >
          <mat-icon *ngIf="isToothSelected4(tooth)">check</mat-icon>
        </div>
      </div>

      <mat-error class="tooth-error" *ngIf="
        form.get('missingTeethList4')!.touched &&
        form.get('missingTeethList4')!.hasError('required')
      ">
        Bitte einen Zahn auswählen.
      </mat-error>

      <!-- SIXTH ROOOWWW  -->
      <div class="tooth-box-group" [ngClass]="{ 'highlighted': isAnySelectedInPair4(pair3A, pair3B) }">
        <div *ngFor="let tooth of [71, 72, 73, 74, 75]"
             class="tooth-box"
             [class.selected]="isToothSelected4(tooth)"
             (click)="toggleTooth4(tooth)">
          <mat-icon *ngIf="isToothSelected4(tooth)">check</mat-icon>
        </div>
      </div>

      <div class="second-tooth-number-row">
        <div *ngFor="let tooth of [71, 72, 73, 74, 75]" 
             class="tooth-number-label"
             [ngClass]="{ 'selected': isToothSelected4(tooth) }">
          {{ tooth }}
        </div>
      </div>

      <mat-error class="tooth-error" *ngIf="
        form.get('missingTeethList4')!.touched &&
        form.get('missingTeethList4')!.hasError('required')
      ">
        Bitte einen Zahn auswählen.
      </mat-error>
    </div> <!-- /tooth-chart -->

  </div>

  <div class="panel-actions" *ngIf="currentStep === 19 && !isStepDone(19)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(19)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>




<!-- QUESTIOONNN 20 -->
<mat-expansion-panel *ngIf="maxStep  >= 20" [expanded]="currentStep === 20">
  <mat-expansion-panel-header>
    <mat-panel-title>20. Ist eine Behandlung bei einem Zahnarzt/ Kieferorthopaden im Gang oder geplant?</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">

    <mat-button-toggle-group
      formControlName="dentistTreatment"
      class="med-toggle-group"
      [class.selected]="form.get('dentistTreatment')?.value !== null"
      aria-label="Zahnfleischzustand"
    >
      <mat-button-toggle value="no">Nein</mat-button-toggle>
      <mat-button-toggle value="yes">Ja</mat-button-toggle>
    </mat-button-toggle-group>

    <mat-error
      class="toggle-error"
      *ngIf="form.get('dentistTreatment')!.hasError('required') && form.get('dentistTreatment')!.touched && currentStep === 20"
    >
      Bitte auswählen: Gut, Mangelhaft oder Schlecht
    </mat-error>

    <!-- CONDITIONAL TEXT INPUT (now wrapped in a real element with a template ref) -->
    <div #dentistTreatmentBlock *ngIf="form.get('dentistTreatment')?.value === 'yes'">
      <p class="subtitle">Wenn ja, welche?</p>

      <div class="field-row">
        <mat-form-field
          appearance="outline"
          class="full-row"
          [class.filled]="!!form.get('dentistTreatmentDetails')?.value"
        >
          <span matPrefix class="prefix-spacer"></span>
          <input
            matInput
            formControlName="dentistTreatmentDetails"
            placeholder="Hier eingeben..."
            type="text"
          />
          <mat-error *ngIf="
            form.get('dentistTreatmentDetails')!.touched &&
            form.get('dentistTreatmentDetails')!.hasError('required')
          ">
            Erforderlich
          </mat-error>
        </mat-form-field>
      </div>
    </div>

  </div>

  <div class="panel-actions" *ngIf="currentStep === 20 && !isStepDone(20)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(20)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>



<!-- QUESTION 21 -->
<mat-expansion-panel *ngIf="maxStep  >= 21" [expanded]="currentStep === 21">
  <mat-expansion-panel-header>
    <mat-panel-title>21. Datum der letzten Radiographie:</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">
    <div class="field-row">
      <div class="date-field">
        <mat-form-field
          appearance="outline"
          [class.filled]="!!form.get('fullDate')?.value"
          class="full-row"
        >
          <span matPrefix class="prefix-spacer"></span>
          <input
            matInput
            [matDatepicker]="startPicker"
            formControlName="fullDate"
            placeholder="MM.TT.JJJJ"
          />
          <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>

          <mat-error *ngIf="form.get('fullDate')?.touched && form.get('fullDate')?.hasError('required')">
            Erforderlich
          </mat-error>
        </mat-form-field>
      </div>
    </div>
  </div>

  <div class="panel-actions" *ngIf="currentStep === 21 && !isStepDone(21)">
    <button type="button" class="next-button" mat-flat-button color="primary" (click)="nextFrom(21)">
      Weiter
    </button>
  </div>
</mat-expansion-panel>



<!-- QUESTION 22 -->
<mat-expansion-panel *ngIf="maxStep >= 22" [expanded]="currentStep === 22" (opened)="currentStep = 22">
  <mat-expansion-panel-header>
    <mat-panel-title>22. Bemerkungen:</mat-panel-title>
  </mat-expansion-panel-header>

  <div class="step-content">
    <div class="field-row">
      <mat-form-field
        appearance="outline"
        class="full-row"
        [class.filled]="!!form.get('treatmentRemarks')?.value"
      >
        <span matPrefix class="prefix-spacer"></span>
        <input
          matInput
          formControlName="treatmentRemarks"
          placeholder="Hier eingeben..."
          type="text"
        />
        <mat-error *ngIf="
          form.get('treatmentRemarks')!.touched &&
          form.get('treatmentRemarks')!.hasError('required')
        ">
          Erforderlich
        </mat-error>
      </mat-form-field>
    </div>
  </div>

<div class="panel-actions" *ngIf="currentStep === 22 && !isStepDone(22)">
  <button
    class="next-button"
    mat-flat-button
    color="primary"
    type="button"
    (click)="nextFrom(22)"
  >
    Weiter
  </button>
</div>






</mat-expansion-panel>


  <div class="form-actions">
    <button
      id="done-button"
      #doneBtn
      mat-raised-button
      color="primary"
      class="done-button"
      type="button"           
      (click)="onSubmit()"
    >
      Done
    </button>
  </div>


    </mat-accordion>
  </form>

  <ng-template #thxTpl>
  <h2 mat-dialog-title>Danke!</h2>
  <mat-dialog-content>
    <p>Ihre Antworten wurden registriert.</p>
    <p>Sie können jetzt zum Anfang zurückkehren.</p>
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <!-- Closing the dialog triggers reset via afterClosed() -->
    <!-- inside your thxTpl -->
<button mat-flat-button type="button" class="btn-orange"color="primary" [mat-dialog-close]="true" cdkFocusInitial>
  Zurück zum Anfang
</button>

  </mat-dialog-actions>
</ng-template>

</div>
</div>